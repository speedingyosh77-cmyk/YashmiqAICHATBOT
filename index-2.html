<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Yashmiq AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: #0a0a0f;
      --surface: #13131a;
      --surface2: #1c1c28;
      --border: rgba(255,255,255,0.08);
      --accent: #7c6cf8;
      --accent2: #e05fff;
      --green: #22d3a5;
      --red: #ff5f7e;
      --text: #eaeaf0;
      --muted: #6b6b82;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Sora', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    body::before {
      content:'';
      position:fixed; inset:0; z-index:0;
      background:
        radial-gradient(ellipse 60% 50% at 15% 10%, rgba(124,108,248,0.13) 0%, transparent 70%),
        radial-gradient(ellipse 50% 40% at 85% 85%, rgba(224,95,255,0.10) 0%, transparent 70%);
      pointer-events:none;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
      position:relative; z-index:10;
      padding:13px 18px;
      background:rgba(10,10,15,0.88);
      backdrop-filter:blur(20px);
      border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .logo { display:flex; align-items:center; gap:10px; }
    .logo-icon {
      width:36px; height:36px;
      background:linear-gradient(135deg,#7c6cf8,#e05fff);
      border-radius:10px;
      display:flex; align-items:center; justify-content:center;
      font-size:1.1rem;
      box-shadow:0 0 18px rgba(124,108,248,0.4);
    }
    .logo h1 {
      font-size:1.1rem; font-weight:700;
      background:linear-gradient(90deg,#fff,#c4bcff);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .logo span { display:block; font-size:0.65rem; color:var(--muted); font-weight:300; }
    .status-pill {
      display:flex; align-items:center; gap:6px;
      padding:5px 12px; border-radius:20px;
      font-size:0.7rem; font-weight:600;
      border:1px solid; cursor:pointer;
      transition:all 0.2s;
    }
    .status-pill.online { background:rgba(34,211,165,0.1); border-color:rgba(34,211,165,0.25); color:var(--green); }
    .status-pill.offline { background:rgba(255,95,126,0.1); border-color:rgba(255,95,126,0.3); color:var(--red); }
    .dot { width:7px; height:7px; border-radius:50%; }
    .online .dot { background:var(--green); animation:pdot 2s infinite; }
    .offline .dot { background:var(--red); }
    @keyframes pdot { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.4;transform:scale(0.7)} }

    /* ‚îÄ‚îÄ SETUP PANEL ‚îÄ‚îÄ */
    #setupPanel {
      position:fixed; inset:0; z-index:100;
      background:rgba(10,10,15,0.97);
      backdrop-filter:blur(20px);
      display:flex; align-items:center; justify-content:center;
      padding:20px;
    }
    .setup-box {
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:20px;
      padding:32px 28px;
      max-width:440px; width:100%;
      box-shadow:0 20px 60px rgba(0,0,0,0.5);
      animation:fadeUp 0.4s ease;
    }
    .setup-box .icon { font-size:2.5rem; text-align:center; margin-bottom:14px; }
    .setup-box h2 {
      font-size:1.3rem; font-weight:700; text-align:center; margin-bottom:6px;
      background:linear-gradient(135deg,#fff,#c4bcff);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .setup-box p { text-align:center; color:var(--muted); font-size:0.82rem; line-height:1.6; margin-bottom:22px; }
    .steps {
      background:var(--surface2); border-radius:12px;
      padding:16px; margin-bottom:20px;
      border:1px solid var(--border);
    }
    .steps p { color:var(--text); font-size:0.8rem; margin-bottom:0; text-align:left; line-height:1.8; }
    .steps a { color:var(--accent); text-decoration:none; font-weight:600; }
    .steps a:hover { text-decoration:underline; }
    .inp-wrap { position:relative; margin-bottom:12px; }
    .inp-wrap input {
      width:100%; padding:13px 46px 13px 16px;
      background:var(--surface2); border:1px solid var(--border);
      border-radius:12px; color:var(--text);
      font-family:'Sora',sans-serif; font-size:0.88rem; outline:none;
      transition:border-color 0.2s;
    }
    .inp-wrap input:focus { border-color:rgba(124,108,248,0.5); }
    .inp-wrap input::placeholder { color:var(--muted); }
    .toggle-vis {
      position:absolute; right:12px; top:50%; transform:translateY(-50%);
      background:none; border:none; color:var(--muted); cursor:pointer; font-size:1rem;
    }
    .btn-primary {
      width:100%; padding:13px;
      background:linear-gradient(135deg,#7c6cf8,#e05fff);
      border:none; border-radius:12px;
      color:#fff; font-family:'Sora',sans-serif;
      font-size:0.92rem; font-weight:700;
      cursor:pointer; transition:transform 0.15s, box-shadow 0.15s;
      box-shadow:0 0 20px rgba(124,108,248,0.3);
    }
    .btn-primary:hover { transform:translateY(-2px); box-shadow:0 6px 25px rgba(124,108,248,0.45); }
    #setupErr {
      display:none; margin-top:10px; padding:10px 14px;
      background:rgba(255,95,126,0.1); border:1px solid rgba(255,95,126,0.3);
      border-radius:10px; color:var(--red); font-size:0.8rem; text-align:center;
    }

    /* ‚îÄ‚îÄ MESSAGES ‚îÄ‚îÄ */
    .msgs {
      flex:1; overflow-y:auto;
      padding:18px 14px;
      display:flex; flex-direction:column; gap:14px;
      position:relative; z-index:1;
      scroll-behavior:smooth;
    }
    .msgs::-webkit-scrollbar { width:4px; }
    .msgs::-webkit-scrollbar-track { background:transparent; }
    .msgs::-webkit-scrollbar-thumb { background:var(--border); border-radius:4px; }

    /* Welcome */
    .welcome {
      margin:auto; text-align:center;
      padding:28px 10px; max-width:480px;
      animation:fadeUp 0.5s ease;
    }
    .welcome-icon { font-size:2.8rem; margin-bottom:12px; display:block; filter:drop-shadow(0 0 18px rgba(124,108,248,0.5)); }
    .welcome h2 {
      font-size:1.4rem; font-weight:700; margin-bottom:8px;
      background:linear-gradient(135deg,#fff,#c4bcff);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .welcome p { color:var(--muted); font-size:0.85rem; line-height:1.6; margin-bottom:20px; }
    .chips { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; }
    .chip {
      padding:7px 13px;
      background:var(--surface2); border:1px solid var(--border);
      border-radius:20px; font-size:0.77rem; cursor:pointer; color:var(--text);
      transition:all 0.2s;
    }
    .chip:hover { background:var(--accent); border-color:var(--accent); color:#fff; transform:translateY(-2px); box-shadow:0 4px 14px rgba(124,108,248,0.3); }

    /* Bubbles */
    .msg { display:flex; gap:10px; animation:fadeUp 0.3s ease; max-width:820px; width:100%; margin:0 auto; }
    .msg.user { flex-direction:row-reverse; }
    @keyframes fadeUp { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
    .av {
      width:33px; height:33px; border-radius:10px;
      display:flex; align-items:center; justify-content:center;
      font-size:0.8rem; font-weight:700; flex-shrink:0; margin-top:2px;
    }
    .msg.user .av { background:linear-gradient(135deg,#7c6cf8,#e05fff); box-shadow:0 0 12px rgba(124,108,248,0.3); }
    .msg.ai .av { background:var(--surface2); border:1px solid var(--border); font-size:0.95rem; }
    .bubble {
      max-width:calc(100% - 48px);
      padding:11px 15px; border-radius:14px;
      line-height:1.65; font-size:0.9rem;
      white-space:pre-wrap; word-break:break-word;
    }
    .msg.user .bubble { background:linear-gradient(135deg,#7c6cf8,#e05fff); color:#fff; border-bottom-right-radius:4px; }
    .msg.ai .bubble { background:var(--surface2); border:1px solid var(--border); color:var(--text); border-bottom-left-radius:4px; }

    /* Loading */
    .lds { display:flex; gap:5px; padding:4px 0; align-items:center; }
    .ld { width:7px; height:7px; border-radius:50%; background:var(--accent); animation:ld 1.3s infinite ease-in-out; }
    .ld:nth-child(1){animation-delay:-0.32s} .ld:nth-child(2){animation-delay:-0.16s}
    @keyframes ld { 0%,80%,100%{transform:scale(0);opacity:0.3} 40%{transform:scale(1);opacity:1} }

    /* Input */
    .input-bar {
      position:relative; z-index:10;
      padding:11px 14px;
      background:rgba(10,10,15,0.92);
      backdrop-filter:blur(20px);
      border-top:1px solid var(--border);
    }
    .input-inner { max-width:820px; margin:0 auto; display:flex; gap:9px; align-items:flex-end; }
    #userInput {
      flex:1; background:var(--surface2); border:1px solid var(--border);
      border-radius:14px; padding:12px 16px;
      font-size:0.9rem; color:var(--text);
      font-family:'Sora',sans-serif; outline:none;
      resize:none; min-height:46px; max-height:130px;
      transition:border-color 0.2s, box-shadow 0.2s; line-height:1.5;
    }
    #userInput::placeholder { color:var(--muted); }
    #userInput:focus { border-color:rgba(124,108,248,0.5); box-shadow:0 0 0 3px rgba(124,108,248,0.08); }
    #sendBtn {
      width:46px; height:46px;
      background:linear-gradient(135deg,#7c6cf8,#e05fff);
      border:none; border-radius:13px;
      color:#fff; font-size:1.1rem; cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      flex-shrink:0; transition:transform 0.15s, box-shadow 0.15s;
      box-shadow:0 0 18px rgba(124,108,248,0.25);
    }
    #sendBtn:hover:not(:disabled) { transform:scale(1.06); box-shadow:0 0 28px rgba(124,108,248,0.45); }
    #sendBtn:disabled { opacity:0.4; cursor:not-allowed; }
    .hint { text-align:center; font-size:0.67rem; color:var(--muted); margin-top:5px; max-width:820px; margin-left:auto; margin-right:auto; }

    @media(max-width:600px) {
      .bubble { font-size:0.87rem; }
      .welcome h2 { font-size:1.2rem; }
      #sendBtn { width:42px; height:42px; }
    }
  </style>
</head>
<body>

<!-- SETUP PANEL -->
<div id="setupPanel">
  <div class="setup-box">
    <div class="icon">üîë</div>
    <h2>Setup Yashmiq AI</h2>
    <p>Masukkan API Key Google Gemini anda.<br/>Ia <strong style="color:#22d3a5">PERCUMA</strong> ‚Äî tiada kad kredit diperlukan!</p>
    <div class="steps">
      <p>
        <strong style="color:#c4bcff">Cara dapatkan API Key percuma:</strong><br/>
        1Ô∏è‚É£ Pergi ke <a href="https://aistudio.google.com/apikey" target="_blank">aistudio.google.com/apikey</a><br/>
        2Ô∏è‚É£ Log masuk dengan akaun Google anda<br/>
        3Ô∏è‚É£ Klik <strong>"Create API Key"</strong><br/>
        4Ô∏è‚É£ Copy key dan tampal di sini ‚¨áÔ∏è
      </p>
    </div>
    <div class="inp-wrap">
      <input type="password" id="keyInput" placeholder="AIza..." autocomplete="off" onkeydown="if(event.key==='Enter')saveKey()"/>
      <button class="toggle-vis" onclick="toggleVis()" id="visBtn">üëÅ</button>
    </div>
    <button class="btn-primary" onclick="saveKey()">‚úÖ Simpan &amp; Mula Guna</button>
    <div id="setupErr"></div>
  </div>
</div>

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-icon">ü§ñ</div>
    <div>
      <h1>Yashmiq AI</h1>
      <span>Dikuasai oleh Groq + Llama 3.3 ‚Ä¢ Percuma</span>
    </div>
  </div>
  <div class="status-pill offline" id="statusPill" onclick="document.getElementById('setupPanel').style.display='flex'" title="Klik untuk tukar API Key">
    <div class="dot"></div>
    <span id="statusTxt">Tiada Key</span>
  </div>
</header>

<!-- MESSAGES -->
<div class="msgs" id="msgs">
  <div class="welcome" id="welcome">
    <span class="welcome-icon">üåü</span>
    <h2>Assalamualaikum! Saya Yashmiq AI</h2>
    <p>Saya dikuasai oleh Google Gemini secara <strong style="color:#22d3a5">PERCUMA</strong>.<br/>Tanya saya apa sahaja dalam Bahasa Melayu!</p>
    <div class="chips">
      <span class="chip" onclick="ask('Bila puasa Ramadhan 2026 di Malaysia?')">üåô Puasa Ramadhan 2026</span>
      <span class="chip" onclick="ask('Harga petrol RON95 terkini Malaysia')">‚õΩ Harga petrol terkini</span>
      <span class="chip" onclick="ask('Siapa Perdana Menteri Malaysia sekarang?')">üèõÔ∏è PM Malaysia</span>
      <span class="chip" onclick="ask('Terangkan cara buat rendang ayam yang sedap')">üçó Resepi rendang</span>
      <span class="chip" onclick="ask('Apakah berita terkini Malaysia hari ini?')">üì∞ Berita terkini</span>
      <span class="chip" onclick="ask('Tulis pantun 4 kerat tentang semangat Malaysia')">üìú Tulis pantun</span>
      <span class="chip" onclick="ask('Apa itu AI dan bagaimana ia berfungsi?')">ü§ñ Apakah AI?</span>
      <span class="chip" onclick="ask('Tips belajar yang berkesan untuk pelajar')">üìö Tips belajar</span>
    </div>
  </div>
</div>

<!-- INPUT -->
<div class="input-bar">
  <div class="input-inner">
    <textarea id="userInput" placeholder="Tanya saya apa sahaja..." rows="1"
      onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
    <button id="sendBtn" onclick="send()" title="Hantar">‚û§</button>
  </div>
  <div class="hint">Enter untuk hantar &nbsp;¬∑&nbsp; Shift+Enter untuk baris baru &nbsp;¬∑&nbsp; <span onclick="document.getElementById('setupPanel').style.display='flex'" style="color:var(--accent);cursor:pointer">Tukar API Key</span></div>
</div>

<script>
  // ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ
  const GROQ_URL = 'https://api.groq.com/openai/v1/chat/completions';

  const SYSTEM_PROMPT = `Anda adalah Yashmiq AI, pembantu pintar Malaysia yang menjawab dalam Bahasa Melayu yang fasih dan tepat.

PERATURAN WAJIB:
- Jawab SENTIASA dalam Bahasa Melayu yang baik dan jelas
- Berikan jawapan yang TEPAT dan YAKIN ‚Äî terus ke inti soalan
- JANGAN kata "saya tidak pasti" atau "sila semak" ‚Äî gunakan fakta di bawah
- Tarikh hari ini: ${new Date().toLocaleDateString('ms-MY',{weekday:'long',year:'numeric',month:'long',day:'numeric'})}

=== FAKTA MALAYSIA TERKINI (2025-2026) ===

üèõÔ∏è POLITIK & KERAJAAN:
- Perdana Menteri Malaysia: Dato' Seri Anwar Ibrahim (sejak November 2022)
- Raja Malaysia (Yang di-Pertuan Agong): Sultan Ibrahim Iskandar (sejak Januari 2024)
- Kerajaan semasa: Kerajaan Perpaduan (Pakatan Harapan + BN + GPS + GRS)

‚öΩ SUKAN:
- Jurulatih Harimau Malaya (bola sepak kebangsaan): Peter Cklamovski (Australia) ‚Äî dilantik 2025, menggantikan Kim Pan-gon
- Malaysia dalam Kelayakan Piala Asia 2027 Kumpulan F bersama Vietnam, Nepal dan Laos

üåô PUASA & TARIKH PENTING 2026:
- Puasa Ramadhan 2026: Bermula sekitar 17-18 Februari 2026 (1 Ramadhan 1447H)
- Hari Raya Aidilfitri 2026: Sekitar 18-19 Mac 2026
- Hari Merdeka: 31 Ogos
- Hari Malaysia: 16 September

‚õΩ EKONOMI:
- Harga petrol RON95 dikawal oleh kerajaan Malaysia di bawah skim subsidi sasaran
- Untuk harga terkini semak myPertamina atau laman web KPDNHEP

üì± TEKNOLOGI & AM:
- AI popular: ChatGPT (OpenAI), Gemini (Google), Claude (Anthropic)
- Malaysia guna ringgit (MYR) sebagai matawang

ARAHAN TAMBAHAN:
- Untuk soalan yang ada dalam fakta di atas, jawab TERUS dengan fakta tersebut
- Untuk soalan lain, jawab berdasarkan pengetahuan terbaik anda
- Jangan terlalu panjang ‚Äî ringkas, tepat, dan berguna`;

  let history = [];
  let apiKey = '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';
  let busy = false;

  // Terus buka tanpa perlu masuk key
  hidSetup();
  setOnline();

  function hidSetup() {
    document.getElementById('setupPanel').style.display = 'none';
  }

  function setOnline() {
    const p = document.getElementById('statusPill');
    p.className = 'status-pill online';
    document.getElementById('statusTxt').textContent = 'Dalam Talian';
    document.getElementById('userInput').focus();
  }

  function toggleVis() {
    const inp = document.getElementById('keyInput');
    inp.type = inp.type === 'password' ? 'text' : 'password';
  }

  function saveKey() {
    const k = document.getElementById('keyInput').value.trim();
    const err = document.getElementById('setupErr');

    if (!k) {
      err.style.display='block'; err.textContent='‚ö†Ô∏è Sila masukkan API Key!';
      return;
    }
    if (!k.startsWith('AIza')) {
      err.style.display='block'; err.textContent='‚ö†Ô∏è Format tidak betul. API Key Gemini bermula dengan "AIza..."';
      return;
    }

    apiKey = k;
    localStorage.setItem('yashmiq_groq_key', k);
    err.style.display='none';
    hidSetup();
    setOnline();
  }

  function autoResize(el) {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight,130)+'px';
  }

  function handleKey(e) {
    if (e.key==='Enter' && !e.shiftKey) { e.preventDefault(); send(); }
  }

  function ask(q) {
    if (!apiKey) { document.getElementById('setupPanel').style.display='flex'; return; }
    document.getElementById('userInput').value = q;
    autoResize(document.getElementById('userInput'));
    send();
  }

  function rmWelcome() {
    const w = document.getElementById('welcome');
    if (w) w.remove();
  }

  function scrollBot() {
    const m = document.getElementById('msgs');
    m.scrollTop = m.scrollHeight;
  }

  function addMsg(text, role) {
    rmWelcome();
    const wrap = document.getElementById('msgs');
    const div = document.createElement('div');
    div.className = `msg ${role}`;

    const av = document.createElement('div');
    av.className = 'av';
    av.textContent = role==='user' ? 'A' : 'ü§ñ';

    const bub = document.createElement('div');
    bub.className = 'bubble';
    bub.textContent = text;

    div.appendChild(av);
    div.appendChild(bub);
    wrap.appendChild(div);
    scrollBot();
  }

  function addLoading() {
    rmWelcome();
    const wrap = document.getElementById('msgs');
    const div = document.createElement('div');
    div.className = 'msg ai'; div.id = 'ld-msg';
    const av = document.createElement('div');
    av.className = 'av'; av.textContent = 'ü§ñ';
    const bub = document.createElement('div');
    bub.className = 'bubble';
    bub.innerHTML = '<div class="lds"><div class="ld"></div><div class="ld"></div><div class="ld"></div></div>';
    div.appendChild(av); div.appendChild(bub);
    wrap.appendChild(div); scrollBot();
  }

  function rmLoading() {
    const el = document.getElementById('ld-msg');
    if (el) el.remove();
  }

  async function send() {
    if (busy) return;
    if (!apiKey) { document.getElementById('setupPanel').style.display='flex'; return; }

    const inp = document.getElementById('userInput');
    const btn = document.getElementById('sendBtn');
    const text = inp.value.trim();
    if (!text) return;

    busy = true;
    inp.value = ''; inp.style.height = 'auto';
    inp.disabled = true; btn.disabled = true;

    addMsg(text, 'user');
    history.push({ role:'user', parts:[{ text }] });
    addLoading();

    try {
      // Bina mesej untuk Groq (format OpenAI)
      const groqMessages = [{ role: 'system', content: SYSTEM_PROMPT }];
      for (const m of history) {
        const role = m.role === 'model' ? 'assistant' : m.role;
        groqMessages.push({ role: role, content: m.parts[0].text });
      }

      const resp = await fetch(GROQ_URL, {
        method:'POST',
        headers:{
          'Content-Type':'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: 'llama-3.3-70b-versatile',
          messages: groqMessages,
          temperature: 0.7,
          max_tokens: 2048
        })
      });

      rmLoading();

      if (!resp.ok) {
        const err = await resp.json().catch(()=>({}));
        throw new Error(err.error?.message || `Ralat HTTP: ${resp.status}`);
      }

      const data = await resp.json();
      const reply = data.choices?.[0]?.message?.content || 'Maaf, tiada respons diterima.';

      history.push({ role:'model', parts:[{ text: reply }] });
      addMsg(reply, 'ai');

    } catch(e) {
      rmLoading();
      console.error(e);
      let msg = '‚ö†Ô∏è ';
      const m = e.message || '';
      if (m.includes('invalid_api_key') || m.includes('401') || m.includes('Unauthorized')) {
        msg += 'API Key tidak sah. Klik "Tukar API Key" di bawah dan masukkan key yang betul dari aistudio.google.com';
        apiKey = '';
        localStorage.removeItem('yashmiq_groq_key');
        document.getElementById('statusPill').className='status-pill offline';
        document.getElementById('statusTxt').textContent='Tiada Key';
      } else if (m.includes('429') || m.includes('RESOURCE_EXHAUSTED')) {
        msg += 'Had percuma telah dicapai. Sila cuba lagi esok (had reset setiap hari).';
      } else if (m.includes('Failed to fetch') || m.includes('NetworkError')) {
        msg += 'Masalah sambungan internet. Sila semak sambungan anda dan cuba lagi.';
      } else {
        msg += m || 'Berlaku ralat. Sila cuba lagi.';
      }
      addMsg(msg, 'ai');
      history.pop();
    }

    busy = false;
    inp.disabled = false; btn.disabled = false;
    inp.focus();
  }
</script>
</body>
</html>
